import { store } from '@/lib/store'; export const runtime='nodejs'; export const dynamic='force-dynamic'; export async function GET(){ const stream=new ReadableStream({start(controller){ const enc=new TextEncoder(); const send=(o:any)=>controller.enqueue(enc.encode(`data: ${JSON.stringify(o)}\n\n`)); send({type:'hello',at:Date.now()}); const unsub=store.subscribe('all',(d)=>send(d)); const hb=setInterval(()=>controller.enqueue(enc.encode(': ping\n\n')),15000); return ()=>{unsub();clearInterval(hb);controller.close();};}}); return new Response(stream,{headers:{'Content-Type':'text/event-stream','Cache-Control':'no-cache, no-transform','Connection':'keep-alive','X-Accel-Buffering':'no'}}); }
