{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/app/dashboard/page.tsx"],"sourcesContent":["'use client';\nimport { useEffect, useMemo, useState } from 'react';\nimport { Device, EquipmentStatus, TelemetryPoint } from '@/lib/types';\nimport { subscribeSSE } from '@/lib/client-sse';\nimport { DeviceCard } from '@/components/DeviceCard';\n\ntype DeviceWithData = { device: Device; telemetry: TelemetryPoint[]; };\n\nasync function fetchDevices(statusFilter: EquipmentStatus | ''): Promise<DeviceWithData[]> {\n  const qs = statusFilter ? `?status=${encodeURIComponent(statusFilter)}` : '';\n  const res = await fetch(`/api/devices${qs}`, { cache: 'no-store' });\n  const json = await res.json();\n  return json.devices as DeviceWithData[];\n}\n\nexport default function DashboardPage() {\n  const [statusFilter, setStatusFilter] = useState<EquipmentStatus|''>('');\n  const [items, setItems] = useState<DeviceWithData[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const load = async () => {\n    setLoading(true);\n    try { setItems(await fetchDevices(statusFilter)); }\n    finally { setLoading(false); }\n  };\n\n  useEffect(() => { load(); }, [statusFilter]);\n\n  useEffect(()=>{\n    const unsub = subscribeSSE('/api/realtime', (msg)=>{\n      if (msg.type === 'device_update') {\n        setItems(prev => prev.map(x => x.device.id === msg.deviceId ? { ...x, device: msg.device } : x));\n      } else if (msg.type === 'telemetry') {\n        setItems(prev => prev.map(x => {\n          if (x.device.id !== msg.deviceId) return x;\n          const nextData = [...x.telemetry, msg.point];\n          if (nextData.length>300) nextData.shift();\n          return { ...x, telemetry: nextData, device: { ...x.device, lastValue: msg.point.v, lastTs: new Date(msg.point.ts).toISOString() } };\n        }));\n      }\n    });\n    return () => unsub();\n  }, []);\n\n  const stats = useMemo(()=>{\n    const total = items.length;\n    const counts = { OK:0, MAINTENANCE:0, FAULT:0, EMERGENCY:0, OFFLINE:0 } as Record<EquipmentStatus,number>;\n    for (const it of items) counts[it.device.status]++;\n    return { total, counts };\n  }, [items]);\n\n  return (\n    <div className=\"grid\" style={{gridTemplateColumns:'repeat(12, 1fr)'}}>\n      <section className=\"card\" style={{gridColumn:'span 12'}}>\n        <div className=\"row\" style={{justifyContent:'space-between'}}>\n          <h2 style={{margin:0}}>Live Equipment Dashboard</h2>\n          <div className=\"row\">\n            <select value={statusFilter} onChange={e => setStatusFilter(e.target.value as any)}>\n              <option value=\"\">All statuses</option>\n              <option value=\"OK\">OK</option>\n              <option value=\"MAINTENANCE\">MAINTENANCE</option>\n              <option value=\"FAULT\">FAULT</option>\n              <option value=\"EMERGENCY\">EMERGENCY</option>\n              <option value=\"OFFLINE\">OFFLINE</option>\n            </select>\n            <button className=\"btn\" onClick={load} disabled={loading}>{loading?'Loadingâ€¦':'Refresh'}</button>\n          </div>\n        </div>\n        <div className=\"row\" style={{marginTop:12}}>\n          <div className=\"card\" style={{flex:'1 1 0'}}>\n            <div>OK</div>\n            <div className=\"kpi\" style={{color:'#22c55e'}}>{stats.counts.OK}</div>\n          </div>\n          <div className=\"card\" style={{flex:'1 1 0'}}>\n            <div>MAINTENANCE</div>\n            <div className=\"kpi\" style={{color:'#f59e0b'}}>{stats.counts.MAINTENANCE}</div>\n          </div>\n          <div className=\"card\" style={{flex:'1 1 0'}}>\n            <div>FAULT</div>\n            <div className=\"kpi\" style={{color:'#ef4444'}}>{stats.counts.FAULT}</div>\n          </div>\n          <div className=\"card\" style={{flex:'1 1 0'}}>\n            <div>EMERGENCY</div>\n            <div className=\"kpi\" style={{color:'#be123c'}}>{stats.counts.EMERGENCY}</div>\n          </div>\n          <div className=\"card\" style={{flex:'1 1 0'}}>\n            <div>OFFLINE</div>\n            <div className=\"kpi\" style={{color:'#94a3b8'}}>{stats.counts.OFFLINE}</div>\n          </div>\n          <div className=\"card\" style={{flex:'1 1 0'}}>\n            <div>TOTAL</div>\n            <div className=\"kpi\">{stats.total}</div>\n          </div>\n        </div>\n      </section>\n\n      <section className=\"card\" style={{gridColumn:'span 12'}}>\n        <h3>Devices</h3>\n        <div className=\"grid\" style={{gridTemplateColumns:'repeat(2, 1fr)'}}>\n          {items.map(({device, telemetry}) => (\n            <DeviceCard key={device.id} device={device} data={telemetry} />\n          ))}\n        </div>\n      </section>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 450, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0],"debugId":null}}]
}