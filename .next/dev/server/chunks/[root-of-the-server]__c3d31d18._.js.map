{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/lib/store.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport { Device, EquipmentStatus, TelemetryPoint, WorkOrder, MetricsSnapshot } from './types';\n\nfunction clamp(n:number,min:number,max:number){ return Math.max(min, Math.min(max,n)); }\nfunction jitter(base:number, spread:number){ return base + (Math.random()*2-1)*spread; }\nfunction makeMetrics(seed=0): MetricsSnapshot {\n  const v1 = jitter(220 + seed*0.5, 5), v2 = jitter(221 + seed*0.5, 5), v3 = jitter(219 + seed*0.5, 5);\n  const i1 = jitter(3.2 + seed*0.05, 0.4), i2 = jitter(3.4 + seed*0.05, 0.4), i3 = jitter(3.1 + seed*0.05, 0.4);\n  const vAvg = (v1+v2+v3)/3, iAvg = (i1+i2+i3)/3;\n  const pf = clamp(jitter(0.92, 0.05), 0.7, 1);\n  return { v1, v2, v3, vAvg, i1, i2, i3, iAvg, pf };\n}\nconst HOSPITAL_META: Record<string,{ hospitalName:string; division:string; district:string; upazila:string; }> = {\n  H1:{ hospitalName:'Sylhet Medical College Hospital', division:'Sylhet', district:'Sylhet', upazila:'Sylhet Sadar' },\n  H2:{ hospitalName:'Chittagong General Hospital', division:'Chattogram', district:'Chattogram', upazila:'Kotwali' },\n  H3:{ hospitalName:'Dhaka Central Hospital', division:'Dhaka', district:'Dhaka', upazila:'Dhanmondi' },\n  H4:{ hospitalName:'Rajshahi Medical College Hospital', division:'Rajshahi', district:'Rajshahi', upazila:'Boalia' },\n  H5:{ hospitalName:'Khulna Medical College Hospital', division:'Khulna', district:'Khulna', upazila:'Khalishpur' },\n};\n\nclass Store {\n  devices:Record<string,Device>={}; telemetry:Record<string,TelemetryPoint[]>={}; workOrders:Record<string,WorkOrder>={}; emitter=new EventEmitter();\n  constructor(){ this.seed(); this.emitter.setMaxListeners(1000); }\n  private seed(){\n    const hospIds=['H1','H2','H3','H4','H5']; const names=['Ventilator','Oxygen Plant','Infusion Pump','ECG'];\n    for(const h of hospIds){\n      for(let i=0;i<4;i++){\n        const id=`D-${h}-${i+1}`; const statusList:EquipmentStatus[]=['OK','OK','OK','MAINTENANCE','OFFLINE','FAULT']; const status=statusList[Math.floor(Math.random()*statusList.length)];\n        const now=Date.now(); const metrics=makeMetrics(i);\n        this.devices[id]={ id, hospitalId:h, name:names[i%4], model:'Model-X', status, lastTs:new Date(now).toISOString(), lastValue:metrics.vAvg, metrics, lastMaintenanceAt:this.randPast(60), equipmentType:names[i%4], division:HOSPITAL_META[h].division, district:HOSPITAL_META[h].district, upazila:HOSPITAL_META[h].upazila, hospitalName:HOSPITAL_META[h].hospitalName };\n        this.telemetry[id]=[];\n        for(let p=0;p<50;p++){ const m=makeMetrics(p*0.03 + i*0.1); this.telemetry[id].push({ ts: now-(50-p)*60000, v: m.vAvg, metrics: m }); }\n      }\n    }\n  }\n  private randPast(days=45){ const d=new Date(Date.now()-Math.floor(Math.random()*days*86400000)); return d.toISOString(); }\n  listDevices(filter?: {status?:EquipmentStatus; hospitalId?:string}){ let ds=Object.values(this.devices); if(filter?.hospitalId) ds=ds.filter(d=>d.hospitalId===filter.hospitalId); if(filter?.status) ds=ds.filter(d=>d.status===filter.status); return ds; }\n  getDevice(id:string){ return this.devices[id]; }\n  getTelemetry(id:string){ return this.telemetry[id]??[]; }\n  setStatus(deviceId:string,status:EquipmentStatus){ const d=this.devices[deviceId]; if(!d) return; d.status=status; d.lastTs=new Date().toISOString(); this.emit('device_update',{deviceId,device:d}); }\n  pushTelemetry(deviceId:string,value?:number){ const arr=this.telemetry[deviceId]??(this.telemetry[deviceId]=[]); const m=makeMetrics(Math.random()); const v=typeof value==='number'?value:m.vAvg; const p:TelemetryPoint={ ts:Date.now(), v, metrics:m }; arr.push(p); if(arr.length>300) arr.shift(); const d=this.devices[deviceId]; if(d){ d.lastValue=v; d.lastTs=new Date(p.ts).toISOString(); d.metrics=m; } this.emit('telemetry',{deviceId,point:p}); }\n  createWorkOrder(deviceId:string,notes?:string){ const id='WO-'+Math.random().toString(36).slice(2,8); const wo:WorkOrder={ id, deviceId, status:'OPEN', notes, createdAt:new Date().toISOString() }; this.workOrders[id]=wo; this.emit('work_order',{workOrder:wo}); return wo; }\n  addDevice({ name, equipmentType, hospitalId, model='Model-X' }:{ name:string; equipmentType:string; hospitalId:string; model?:string; }){\n    const id = `D-${hospitalId}-${Math.random().toString(36).slice(2,6)}`;\n    const now=Date.now(); const m = makeMetrics(Math.random());\n    const loc = (HOSPITAL_META as any)[hospitalId] || { division:'Unknown', district:'Unknown', upazila:'Unknown', hospitalName:hospitalId };\n    this.devices[id] = { id, hospitalId, name, model, equipmentType, status:'OK', lastTs:new Date(now).toISOString(), lastValue:m.vAvg, metrics:m, lastMaintenanceAt:this.randPast(30), division:loc.division, district:loc.district, upazila:loc.upazila, hospitalName:loc.hospitalName };\n    this.telemetry[id] = [];\n    for(let p=0;p<30;p++){ const mm=makeMetrics(Math.random()); this.telemetry[id].push({ ts: now-(30-p)*60000, v:mm.vAvg, metrics:mm }); }\n    this.emit('device_update',{deviceId:id, device:this.devices[id]});\n    return this.devices[id];\n  }\n  removeDevice(id:string){ if(this.devices[id]){ delete this.devices[id]; delete this.telemetry[id]; this.emit('device_update',{deviceId:id, device:null}); return true; } return false; }\n  emit(type:string,p:any){ this.emitter.emit(type,p); this.emitter.emit('all',{type,...p}); }\n  subscribe(ev:'all'|'device_update'|'telemetry'|'work_order',cb:(d:any)=>void){ this.emitter.on(ev,cb); return ()=>this.emitter.off(ev,cb); }\n}\nconst g=global as any; export const store:Store=g.__IIOT_STORE__||(g.__IIOT_STORE__=new Store());\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/lib/config.ts"],"sourcesContent":["export const IOTDB_ENABLE = process.env.IOTDB_ENABLE === '1';\nexport const IOTDB_HOST = process.env.IOTDB_HOST || '127.0.0.1';\nexport const IOTDB_PORT = Number(process.env.IOTDB_PORT || 6667);\nexport const IOTDB_USER = process.env.IOTDB_USER || 'root';\nexport const IOTDB_PASS = process.env.IOTDB_PASS || 'root';\n"],"names":[],"mappings":";;;;;;;;;;;;AAAO,MAAM,eAAe,QAAQ,GAAG,CAAC,YAAY,KAAK;AAClD,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,aAAa,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;AACpD,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI","debugId":null}},
    {"offset": {"line": 327, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/lib/iotdb.ts"],"sourcesContent":["import { IOTDB_ENABLE, IOTDB_HOST, IOTDB_PORT, IOTDB_USER, IOTDB_PASS } from '@/lib/config';\nimport type { TelemetryPoint, MetricsSnapshot } from '@/lib/types';\n\n/**\n * This module provides a *thin optional* IoTDB integration.\n * If env IOTDB_ENABLE=1 and the Node client is installed, we'll use it.\n * Otherwise, the exported functions no-op and the app falls back to in-memory store.\n *\n * Node client to install: @apache/iotdb-session-nodejs\n *   npm i @apache/iotdb-session-nodejs\n */\ntype Session = any;\nlet session: Session | null = null;\nlet initTried = false;\n\nasync function ensureSession(): Promise<Session | null> {\n  if (!IOTDB_ENABLE) return null;\n  if (session) return session;\n  if (initTried) return null;\n  initTried = true;\n  try {\n    const lib = await import('@apache/iotdb-session-nodejs');\n    const { Session: IoTSession } = lib as any;\n    const s = new IoTSession(IOTDB_HOST, IOTDB_PORT, IOTDB_USER, IOTDB_PASS, { fetchSize: 1024 });\n    await s.open(false);\n    session = s;\n    return session;\n  } catch (e) {\n    console.warn('[IoTDB] Optional client not installed or failed to open session. Fallback to memory.', e);\n    return null;\n  }\n}\n\nexport async function iotdbHealth(): Promise<{ ok: boolean; message: string }>{ \n  const s = await ensureSession();\n  if (!s) return { ok:false, message: 'IoTDB disabled or client not installed' };\n  try { await s.testInsertRecord('root.demo.test', Date.now(), ['x'], ['1']); return { ok:true, message:'connected' }; }\n  catch (e:any){ return { ok:false, message: String(e?.message||e) }; }\n}\n\n/** Write a telemetry snapshot for a device into IoTDB (if enabled) */\nexport async function iotdbWrite(deviceId:string, m: MetricsSnapshot){\n  const s = await ensureSession(); if (!s) return false;\n  const ts = Date.now();\n  const measurement = `root.ygen.devices.${deviceId.replace(/[^A-Za-z0-9_]/g,'_')}`;\n  const measureNames = ['v1','v2','v3','vAvg','i1','i2','i3','iAvg','pf'];\n  const values = [m.v1,m.v2,m.v3,m.vAvg,m.i1,m.i2,m.i3,m.iAvg,m.pf];\n  try{\n    await s.insertRecord(measurement, ts, measureNames, values);\n    return true;\n  }catch(e){\n    console.warn('[IoTDB] insert failed', e);\n    return false;\n  }\n}\n\n/** Read last N points for device from IoTDB (if enabled) */\nexport async function iotdbQuery(deviceId:string, limit=50): Promise<TelemetryPoint[]>{\n  const s = await ensureSession(); if (!s) return [];\n  const mpath = `root.ygen.devices.${deviceId.replace(/[^A-Za-z0-9_]/g,'_')}`;\n  const sql = `select vAvg,v1,v2,v3,iAvg,i1,i2,i3,pf from ${mpath} order by time desc limit ${limit}`;\n  try{\n    const ds = await s.executeQueryStatement(sql);\n    const rows: TelemetryPoint[] = [];\n    while (ds.hasNext()) {\n      const r = ds.next();\n      const ts = Number(r.getTimestamp());\n      const vAvg = Number(r.getFields().get(0).getDoubleV());\n      const v1 = Number(r.getFields().get(1).getDoubleV());\n      const v2 = Number(r.getFields().get(2).getDoubleV());\n      const v3 = Number(r.getFields().get(3).getDoubleV());\n      const iAvg = Number(r.getFields().get(4).getDoubleV());\n      const i1 = Number(r.getFields().get(5).getDoubleV());\n      const i2 = Number(r.getFields().get(6).getDoubleV());\n      const i3 = Number(r.getFields().get(7).getDoubleV());\n      const pf = Number(r.getFields().get(8).getDoubleV());\n      rows.push({ ts, v: vAvg, metrics: { vAvg,v1,v2,v3,iAvg,i1,i2,i3,pf } as any });\n    }\n    await ds.close();\n    return rows.reverse(); // return ascending time\n  } catch (e) {\n    console.warn('[IoTDB] query failed', e);\n    return [];\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 467, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/lib/telemetry-source.ts"],"sourcesContent":["import { iotdbQuery, iotdbWrite } from '@/lib/iotdb';\nimport { store } from '@/lib/store';\nimport type { TelemetryPoint, MetricsSnapshot } from '@/lib/types';\nimport { IOTDB_ENABLE } from '@/lib/config';\n\nexport async function getTelemetryPoints(deviceId:string, limit=50): Promise<TelemetryPoint[]>{\n  if (IOTDB_ENABLE) {\n    const pts = await iotdbQuery(deviceId, limit);\n    if (pts.length) return pts;\n  }\n  // fallback: in-memory\n  const arr = store.getTelemetry(deviceId).slice(-limit);\n  return arr;\n}\n\nexport async function persistTelemetry(deviceId:string, m: MetricsSnapshot){\n  if (!IOTDB_ENABLE) return;\n  await iotdbWrite(deviceId, m);\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAEA;;;;AAEO,eAAe,mBAAmB,QAAe,EAAE,QAAM,EAAE;IAChE,IAAI,+HAAY,EAAE;QAChB,MAAM,MAAM,MAAM,IAAA,4HAAU,EAAC,UAAU;QACvC,IAAI,IAAI,MAAM,EAAE,OAAO;IACzB;IACA,sBAAsB;IACtB,MAAM,MAAM,uHAAK,CAAC,YAAY,CAAC,UAAU,KAAK,CAAC,CAAC;IAChD,OAAO;AACT;AAEO,eAAe,iBAAiB,QAAe,EAAE,CAAkB;IACxE,IAAI,CAAC,+HAAY,EAAE;IACnB,MAAM,IAAA,4HAAU,EAAC,UAAU;AAC7B","debugId":null}},
    {"offset": {"line": 496, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/app/api/devices/route.ts"],"sourcesContent":["import { store } from '@/lib/store'; import { EquipmentStatus } from '@/lib/types'; import { getTelemetryPoints } from '@/lib/telemetry-source';\nexport const runtime='nodejs'; export const dynamic='force-dynamic';\nexport async function GET(req:Request){\n  const url=new URL(req.url);\n  const hospitalId=url.searchParams.get('hospitalId')||undefined;\n  const status=url.searchParams.get('status') as EquipmentStatus | null;\n  const deviceId=url.searchParams.get('deviceId')||undefined;\n  const division=url.searchParams.get('division')||undefined;\n  const district=url.searchParams.get('district')||undefined;\n  const upazila=url.searchParams.get('upazila')||undefined;\n  const hospital=url.searchParams.get('hospital')||undefined;\n  const equipment=url.searchParams.get('equipment')||undefined;\n\n  let devices;\n  if(deviceId){ const d=store.getDevice(deviceId); devices=d?[d]:[]; }\n  else { devices=store.listDevices({hospitalId,status:status??undefined}); }\n  let list = devices;\n  list = list.filter((d:any)=> !division || d.division===division);\n  list = list.filter((d:any)=> !district || d.district===district);\n  list = list.filter((d:any)=> !upazila || d.upazila===upazila);\n  list = list.filter((d:any)=> !hospital || d.hospitalName===hospital);\n  list = list.filter((d:any)=> !equipment || d.equipmentType===equipment);\n  const payload=await Promise.all(list.map(async (d:any)=>({ device:d, telemetry: await getTelemetryPoints(d.id, 50) })));\n  return Response.json({ devices: payload });\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAoF;;;AAC7E,MAAM,UAAQ;AAAiB,MAAM,UAAQ;AAC7C,eAAe,IAAI,GAAW;IACnC,MAAM,MAAI,IAAI,IAAI,IAAI,GAAG;IACzB,MAAM,aAAW,IAAI,YAAY,CAAC,GAAG,CAAC,iBAAe;IACrD,MAAM,SAAO,IAAI,YAAY,CAAC,GAAG,CAAC;IAClC,MAAM,WAAS,IAAI,YAAY,CAAC,GAAG,CAAC,eAAa;IACjD,MAAM,WAAS,IAAI,YAAY,CAAC,GAAG,CAAC,eAAa;IACjD,MAAM,WAAS,IAAI,YAAY,CAAC,GAAG,CAAC,eAAa;IACjD,MAAM,UAAQ,IAAI,YAAY,CAAC,GAAG,CAAC,cAAY;IAC/C,MAAM,WAAS,IAAI,YAAY,CAAC,GAAG,CAAC,eAAa;IACjD,MAAM,YAAU,IAAI,YAAY,CAAC,GAAG,CAAC,gBAAc;IAEnD,IAAI;IACJ,IAAG,UAAS;QAAE,MAAM,IAAE,uHAAK,CAAC,SAAS,CAAC;QAAW,UAAQ,IAAE;YAAC;SAAE,GAAC,EAAE;IAAE,OAC9D;QAAE,UAAQ,uHAAK,CAAC,WAAW,CAAC;YAAC;YAAW,QAAO,UAAQ;QAAS;IAAI;IACzE,IAAI,OAAO;IACX,OAAO,KAAK,MAAM,CAAC,CAAC,IAAS,CAAC,YAAY,EAAE,QAAQ,KAAG;IACvD,OAAO,KAAK,MAAM,CAAC,CAAC,IAAS,CAAC,YAAY,EAAE,QAAQ,KAAG;IACvD,OAAO,KAAK,MAAM,CAAC,CAAC,IAAS,CAAC,WAAW,EAAE,OAAO,KAAG;IACrD,OAAO,KAAK,MAAM,CAAC,CAAC,IAAS,CAAC,YAAY,EAAE,YAAY,KAAG;IAC3D,OAAO,KAAK,MAAM,CAAC,CAAC,IAAS,CAAC,aAAa,EAAE,aAAa,KAAG;IAC7D,MAAM,UAAQ,MAAM,QAAQ,GAAG,CAAC,KAAK,GAAG,CAAC,OAAO,IAAQ,CAAC;YAAE,QAAO;YAAG,WAAW,MAAM,wJAAmB,EAAE,EAAE,EAAE;QAAI,CAAC;IACpH,OAAO,SAAS,IAAI,CAAC;QAAE,SAAS;IAAQ;AAC1C","debugId":null}}]
}