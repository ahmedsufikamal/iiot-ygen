{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/lib/store.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport { Device, EquipmentStatus, TelemetryPoint, WorkOrder, MetricsSnapshot } from './types';\n\nfunction clamp(n:number,min:number,max:number){ return Math.max(min, Math.min(max,n)); }\nfunction jitter(base:number, spread:number){ return base + (Math.random()*2-1)*spread; }\nfunction makeMetrics(seed=0): MetricsSnapshot {\n  const v1 = jitter(220 + seed*0.5, 5), v2 = jitter(221 + seed*0.5, 5), v3 = jitter(219 + seed*0.5, 5);\n  const i1 = jitter(3.2 + seed*0.05, 0.4), i2 = jitter(3.4 + seed*0.05, 0.4), i3 = jitter(3.1 + seed*0.05, 0.4);\n  const vAvg = (v1+v2+v3)/3, iAvg = (i1+i2+i3)/3;\n  const pf = clamp(jitter(0.92, 0.05), 0.7, 1);\n  return { v1, v2, v3, vAvg, i1, i2, i3, iAvg, pf };\n}\nconst HOSPITAL_META: Record<string,{ hospitalName:string; division:string; district:string; upazila:string; }> = {\n  H1:{ hospitalName:'Sylhet Medical College Hospital', division:'Sylhet', district:'Sylhet', upazila:'Sylhet Sadar' },\n  H2:{ hospitalName:'Chittagong General Hospital', division:'Chattogram', district:'Chattogram', upazila:'Kotwali' },\n  H3:{ hospitalName:'Dhaka Central Hospital', division:'Dhaka', district:'Dhaka', upazila:'Dhanmondi' },\n  H4:{ hospitalName:'Rajshahi Medical College Hospital', division:'Rajshahi', district:'Rajshahi', upazila:'Boalia' },\n  H5:{ hospitalName:'Khulna Medical College Hospital', division:'Khulna', district:'Khulna', upazila:'Khalishpur' },\n};\n\nclass Store {\n  devices:Record<string,Device>={}; telemetry:Record<string,TelemetryPoint[]>={}; workOrders:Record<string,WorkOrder>={}; emitter=new EventEmitter();\n  constructor(){ this.seed(); this.emitter.setMaxListeners(1000); }\n  private seed(){\n    const hospIds=['H1','H2','H3','H4','H5']; const names=['Ventilator','Oxygen Plant','Infusion Pump','ECG'];\n    for(const h of hospIds){\n      for(let i=0;i<4;i++){\n        const id=`D-${h}-${i+1}`; const statusList:EquipmentStatus[]=['OK','OK','OK','MAINTENANCE','OFFLINE','FAULT']; const status=statusList[Math.floor(Math.random()*statusList.length)];\n        const now=Date.now(); const metrics=makeMetrics(i);\n        this.devices[id]={ id, hospitalId:h, name:names[i%4], model:'Model-X', status, lastTs:new Date(now).toISOString(), lastValue:metrics.vAvg, metrics, lastMaintenanceAt:this.randPast(60), equipmentType:names[i%4], division:HOSPITAL_META[h].division, district:HOSPITAL_META[h].district, upazila:HOSPITAL_META[h].upazila, hospitalName:HOSPITAL_META[h].hospitalName };\n        this.telemetry[id]=[];\n        for(let p=0;p<50;p++){ const m=makeMetrics(p*0.03 + i*0.1); this.telemetry[id].push({ ts: now-(50-p)*60000, v: m.vAvg, metrics: m }); }\n      }\n    }\n  }\n  private randPast(days=45){ const d=new Date(Date.now()-Math.floor(Math.random()*days*86400000)); return d.toISOString(); }\n  listDevices(filter?: {status?:EquipmentStatus; hospitalId?:string}){ let ds=Object.values(this.devices); if(filter?.hospitalId) ds=ds.filter(d=>d.hospitalId===filter.hospitalId); if(filter?.status) ds=ds.filter(d=>d.status===filter.status); return ds; }\n  getDevice(id:string){ return this.devices[id]; }\n  getTelemetry(id:string){ return this.telemetry[id]??[]; }\n  setStatus(deviceId:string,status:EquipmentStatus){ const d=this.devices[deviceId]; if(!d) return; d.status=status; d.lastTs=new Date().toISOString(); this.emit('device_update',{deviceId,device:d}); }\n  pushTelemetry(deviceId:string,value?:number){ const arr=this.telemetry[deviceId]??(this.telemetry[deviceId]=[]); const m=makeMetrics(Math.random()); const v=typeof value==='number'?value:m.vAvg; const p:TelemetryPoint={ ts:Date.now(), v, metrics:m }; arr.push(p); if(arr.length>300) arr.shift(); const d=this.devices[deviceId]; if(d){ d.lastValue=v; d.lastTs=new Date(p.ts).toISOString(); d.metrics=m; } this.emit('telemetry',{deviceId,point:p}); }\n  createWorkOrder(deviceId:string,notes?:string){ const id='WO-'+Math.random().toString(36).slice(2,8); const wo:WorkOrder={ id, deviceId, status:'OPEN', notes, createdAt:new Date().toISOString() }; this.workOrders[id]=wo; this.emit('work_order',{workOrder:wo}); return wo; }\n  addDevice({ name, equipmentType, hospitalId, model='Model-X' }:{ name:string; equipmentType:string; hospitalId:string; model?:string; }){\n    const id = `D-${hospitalId}-${Math.random().toString(36).slice(2,6)}`;\n    const now=Date.now(); const m = makeMetrics(Math.random());\n    const loc = (HOSPITAL_META as any)[hospitalId] || { division:'Unknown', district:'Unknown', upazila:'Unknown', hospitalName:hospitalId };\n    this.devices[id] = { id, hospitalId, name, model, equipmentType, status:'OK', lastTs:new Date(now).toISOString(), lastValue:m.vAvg, metrics:m, lastMaintenanceAt:this.randPast(30), division:loc.division, district:loc.district, upazila:loc.upazila, hospitalName:loc.hospitalName };\n    this.telemetry[id] = [];\n    for(let p=0;p<30;p++){ const mm=makeMetrics(Math.random()); this.telemetry[id].push({ ts: now-(30-p)*60000, v:mm.vAvg, metrics:mm }); }\n    this.emit('device_update',{deviceId:id, device:this.devices[id]});\n    return this.devices[id];\n  }\n  removeDevice(id:string){ if(this.devices[id]){ delete this.devices[id]; delete this.telemetry[id]; this.emit('device_update',{deviceId:id, device:null}); return true; } return false; }\n  emit(type:string,p:any){ this.emitter.emit(type,p); this.emitter.emit('all',{type,...p}); }\n  subscribe(ev:'all'|'device_update'|'telemetry'|'work_order',cb:(d:any)=>void){ this.emitter.on(ev,cb); return ()=>this.emitter.off(ev,cb); }\n}\nconst g=global as any; export const store:Store=g.__IIOT_STORE__||(g.__IIOT_STORE__=new Store());\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/app/api/meta/route.ts"],"sourcesContent":["import { store } from '@/lib/store'; export const runtime='nodejs'; export const dynamic='force-dynamic'; export async function GET(){ const devices=store.listDevices(); return Response.json({ devices }); }\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAA4C,MAAM,UAAQ;AAAiB,MAAM,UAAQ;AAAwB,eAAe;IAAO,MAAM,UAAQ,uHAAK,CAAC,WAAW;IAAI,OAAO,SAAS,IAAI,CAAC;QAAE;IAAQ;AAAI","debugId":null}}]
}