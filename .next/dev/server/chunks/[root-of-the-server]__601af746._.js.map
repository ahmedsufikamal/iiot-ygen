{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/lib/store.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport { Device, EquipmentStatus, TelemetryPoint, WorkOrder, MetricsSnapshot } from './types';\n\nfunction clamp(n:number,min:number,max:number){ return Math.max(min, Math.min(max,n)); }\nfunction jitter(base:number, spread:number){ return base + (Math.random()*2-1)*spread; }\nfunction makeMetrics(seed=0): MetricsSnapshot {\n  const v1 = jitter(220 + seed*0.5, 5);\n  const v2 = jitter(221 + seed*0.5, 5);\n  const v3 = jitter(219 + seed*0.5, 5);\n  const i1 = jitter(3.2 + seed*0.05, 0.4);\n  const i2 = jitter(3.4 + seed*0.05, 0.4);\n  const i3 = jitter(3.1 + seed*0.05, 0.4);\n  const vAvg = (v1+v2+v3)/3;\n  const iAvg = (i1+i2+i3)/3;\n  const pf = clamp(jitter(0.92, 0.05), 0.7, 1);\n  return { v1, v2, v3, vAvg, i1, i2, i3, iAvg, pf };\n}\n\nfunction randPast(days=45){ const d=new Date(Date.now()-Math.floor(Math.random()*days*86400000)); return d.toISOString(); }\nclass Store {\n  devices:Record<string,Device>={};\n  telemetry:Record<string,TelemetryPoint[]>={};\n  workOrders:Record<string,WorkOrder> = {};\n  emitter=new EventEmitter();\n\n  constructor(){ this.seed(); this.emitter.setMaxListeners(1000); }\n\n  private seed(){\n    const hospIds=['H1','H2','H3','H4','H5']; const names=['Ventilator','Oxygen Plant','Infusion Pump','ECG'];\n    for(const h of hospIds){\n      for(let i=0;i<4;i++){\n        const id=`D-${h}-${i+1}`;\n        const statusList:EquipmentStatus[]=['OK','OK','OK','MAINTENANCE','OFFLINE','FAULT'];\n        const status=statusList[Math.floor(Math.random()*statusList.length)];\n        const now=Date.now();\n        const metrics=makeMetrics(i);\n        this.devices[id]={ id, hospitalId:h, name:names[i%4], model:'Model-X', status, lastTs:new Date(now).toISOString(), lastValue:metrics.vAvg, metrics, lastMaintenanceAt: randPast(60) };\n        this.telemetry[id]=[];\n        for(let p=0;p<50;p++){\n          const m=makeMetrics(p*0.03 + i*0.1);\n          this.telemetry[id].push({ ts: now-(50-p)*60000, v: m.vAvg, metrics: m });\n        }\n      }\n    }\n  }\n\n  listDevices(f?:{status?:EquipmentStatus; hospitalId?:string}){\n    let ds=Object.values(this.devices);\n    if(f?.hospitalId) ds=ds.filter(d=>d.hospitalId===f.hospitalId);\n    if(f?.status) ds=ds.filter(d=>d.status===f.status);\n    return ds;\n  }\n  getDevice(id:string){ return this.devices[id]; }\n  getTelemetry(id:string){ return this.telemetry[id]??[]; }\n\n  setStatus(deviceId:string,status:EquipmentStatus){\n    const d=this.devices[deviceId]; if(!d) return; d.status=status; d.lastTs=new Date().toISOString();\n    this.emit('device_update',{deviceId,device:d});\n  }\n  pushTelemetry(deviceId:string,value?:number){\n    const arr=this.telemetry[deviceId]??(this.telemetry[deviceId]=[]);\n    const m=makeMetrics(Math.random()); const v=typeof value==='number'?value:m.vAvg;\n    const p:TelemetryPoint={ ts:Date.now(), v, metrics:m }; arr.push(p); if(arr.length>300) arr.shift();\n    const d=this.devices[deviceId]; if(d){ d.lastValue=v; d.lastTs=new Date(p.ts).toISOString(); d.metrics=m; }\n    this.emit('telemetry',{deviceId,point:p});\n  }\n  createWorkOrder(deviceId:string,notes?:string){\n    const id='WO-'+Math.random().toString(36).slice(2,8);\n    const wo:WorkOrder={ id, deviceId, status:'OPEN', notes, createdAt:new Date().toISOString() };\n    this.workOrders[id]=wo; this.emit('work_order',{workOrder:wo}); return wo;\n  }\n  emit(type:string,p:any){ this.emitter.emit(type,p); this.emitter.emit('all',{type,...p}); }\n  subscribe(ev:'all'|'device_update'|'telemetry'|'work_order',cb:(d:any)=>void){ this.emitter.on(ev,cb); return ()=>this.emitter.off(ev,cb); }\n}\nconst g=global as any; export const store:Store=g.__IIOT_STORE__||(g.__IIOT_STORE__=new Store());\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///Users/sufi-mac-pro/Documents/2.%20Other%20Drive/0000.%20WebDesign/iiot-ygen/app/api/simulate/route.ts"],"sourcesContent":["import { store } from '@/lib/store'; import { EquipmentStatus } from '@/lib/types'; export const runtime='nodejs'; export const dynamic='force-dynamic'; export async function POST(req:Request){ const body=await req.json().catch(()=>({})); const { deviceId,status,value } = body as { deviceId?:string; status?:EquipmentStatus; value?:number }; if(!deviceId) return Response.json({error:'deviceId required'},{status:400}); if(status) store.setStatus(deviceId,status); if(typeof value==='number') store.pushTelemetry(deviceId,value); else store.pushTelemetry(deviceId); return Response.json({ ok:true, device: store.getDevice(deviceId), last: store.getTelemetry(deviceId).slice(-1)[0] }); }\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAA2F,MAAM,UAAQ;AAAiB,MAAM,UAAQ;AAAwB,eAAe,KAAK,GAAW;IAAG,MAAM,OAAK,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;IAAI,MAAM,EAAE,QAAQ,EAAC,MAAM,EAAC,KAAK,EAAE,GAAG;IAAsE,IAAG,CAAC,UAAU,OAAO,SAAS,IAAI,CAAC;QAAC,OAAM;IAAmB,GAAE;QAAC,QAAO;IAAG;IAAI,IAAG,QAAQ,uHAAK,CAAC,SAAS,CAAC,UAAS;IAAS,IAAG,OAAO,UAAQ,UAAU,uHAAK,CAAC,aAAa,CAAC,UAAS;SAAa,uHAAK,CAAC,aAAa,CAAC;IAAW,OAAO,SAAS,IAAI,CAAC;QAAE,IAAG;QAAM,QAAQ,uHAAK,CAAC,SAAS,CAAC;QAAW,MAAM,uHAAK,CAAC,YAAY,CAAC,UAAU,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE;IAAC;AAAI","debugId":null}}]
}